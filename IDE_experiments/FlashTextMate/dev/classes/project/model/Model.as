
package project.model {

	import flash.events.EventDispatcher;
	import project.events.AppEvent;
	import com.ordinarykids.utils.StringUtils;
	import com.ordinarykids.net.XMLBatchLoader;
	import com.ordinarykids.events.BatchLoadEvent;
////////////////////////////////////////////////////////////////////////////////////////////////////////////|
////////////////////////////////////////////////////////////////////////////////////////////////////////////|
////////////////////////////////////////////////////////////////////////////////////////////////////////////|
////////////////////////////////////////////////////////////////////////////////////////////////////////////| 
//| Class responsible for loading the initial xml documents
//| that contain the foundation data structures for the site		
		
	public class Model extends EventDispatcher {
	    
	//| XML Bundles
		private static var _about		:XML; 
					
		private static var _XMLLoader	:XMLBatchLoader;
		private static var _start:Date;
		
		public function Model ($files:XMLList)
		{		
			trace("Requesting Site XML"); _start = new Date();
			
		//| load the list of xml files specified in config.xml //	
			_XMLLoader = new XMLBatchLoader($files);
			_XMLLoader.addEventListener(BatchLoadEvent.BATCH_COMPLETE, onXMLBatchComplete);
		}
	
////////////////////////////////////////////////////////////////////////////////////////////////////////////|
////////////////////////////////////////////////////////////////////////////////////////////////////////////| 
//| PUBLIC STATIC GETTERS	
	
		public static function get about():XML
		{
			return _about;
		}
////////////////////////////////////////////////////////////////////////////////////////////////////////////|
////////////////////////////////////////////////////////////////////////////////////////////////////////////| 
//| PARSE XML FILES IN VALUE OBJECTS	
		
		private function onXMLBatchComplete(evt:BatchLoadEvent):void
		{
			trace("Site XML Took", (new Date().time-_start.time)/1000, 'Seconds To Load');
			
			var xml:Array = evt.data as Array;
			
			_about = xml[0];
			
			dispatchEvent(new AppEvent(AppEvent.XML_READY));
		}
////////////////////////////////////////////////////////////////////////////////////////////////////////////| 	
	}

}
